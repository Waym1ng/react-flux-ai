# Flux AI 绘画接口文档

## Host

`https://api.grsai.com`

使用方式：`Host` + 接口路径，例如：`https://api.grsai.com/v1/draw/flux`

## Flux 绘画接口

### 请求信息

- **路径:** `/v1/draw/flux`
- **方法:** `POST`
- **响应方式:** `stream` 或 回调接口

### 请求头 Headers

```json
{
  "Content-Type": "application/json",
  "Authorization": "Bearer apikey"
}
```

### 请求参数 (JSON)

```json
{
  "model": "flux-kontext-max",
  "urls": [
    "https://example.com/example.png"
  ],
  "prompt": "提示词",
  "seed": 21324124,
  "aspectRatio": "1:1",
  "webHook": "https://example.com/callback",
  "shutProgress": false,
  "cdn": "global"
}
```

### 参数说明

- `model` (必填)
  - **类型:** `string`
  - **示例:** `"flux-kontext-max"`
  - **描述:** 支持模型:
    - `flux-pro-1.1`
    - `flux-pro-1.1-ultra`
    - `flux-kontext-pro`
    - `flux-kontext-max`

- `prompt` (必填)
  - **类型:** `string`
  - **示例:** `"一只可爱的猫咪在草地上玩耍"`
  - **描述:** 提示词

- `urls` (选填)
  - **类型:** `string[]`
  - **示例:** `["https://example.com/example.png"]`
  - **描述:** 参考图片的URL。该参数支持模型: `flux-kontext-pro`, `flux-kontext-max`

- `seed` (选填)
  - **类型:** `number`
  - **示例:** `123456`
  - **描述:** 随机种子, 填0则随机

- `aspectRatio` (选填)
  - **类型:** `string`
  - **示例:** `"1:1"`
  - **描述:** 输出图像比例, 支持常用的比例, 例如: `1:1`, `16:9`, `9:16`, `4:3`, `1:2`, `21:9`, `2:3`, `3:2` 等。
    - 除了设定比例外，还可以根据参考图自动匹配比例，填写参数: `auto` 即可。

- `webHook` (选填)
  - **类型:** `string`
  - **示例:** `"https://your-webhook-url.com/callback"`
  - **描述:** 进度与结果的回调链接。接口默认以Stream流式响应进行回复。如果填了`webHook`，进度与结果则以Post请求回调地址的方式进行回复。
    - **请求头:** `Content-Type: application/json`
    - 如果不使用回调，而使用轮询`result`接口方式获取结果，需要接口立即返回一个id，则`webHook`参数填`"-1"`，那么会立即返回一个id。

- `shutProgress` (选填)
  - **类型:** `boolean`
  - **示例:** `false`
  - **描述:** 关闭进度回复，直接回复最终结果，建议搭配`webHook`使用。默认`false`。

- `cdn` (选填)
  - **类型:** `string`
  - **示例:** `"global"`
  - **描述:** 返回的图片链接地址地区, 可选: `"global"`、`"zh"`。
    - `global` (全球)
    - `zh` (国内)
    - 默认`global`

### webHook 结果 (请求后该结果会返回一个id，用于对应回调数据)

(使用流式响应请跳过该步骤)

```json
{
  "code": 0,
  "msg": "success",
  "data": {
    "id": "id"
  }
}
```

### webHook 结果参数说明

(使用流式响应请跳过该步骤)

- `code`
  - **类型:** `number`
  - **示例:** `0`
  - **描述:** 状态码：0为成功

- `msg`
  - **类型:** `string`
  - **示例:** `"success"`
  - **描述:** 状态信息

- `data`
  - **类型:** `object`
  - **描述:** 数据

- `data.id`
  - **类型:** `string`
  - **示例:** `"f44bcf50-f2d0-4c26-a467-26f2014a771b"`
  - **描述:** 程序任务id，对应回调数据

### 响应参数 (JSON) (流式响应与webHook响应的参数)

```json
{
  "id": "xxxxx",
  "url": "https://example.com/example.png",
  "seed": 322143556,
  "progress": 100,
  "status": "succeeded",
  "failure_reason": "",
  "error": ""
}
```

### 响应参数说明

- `id`
  - **类型:** `string`
  - **示例:** `"f44bcf50-f2d0-4c26-a467-26f2014a771b"`
  - **描述:** Id (webHook回调可以用该id来对应数据)

- `url`
  - **类型:** `string`
  - **示例:** `"https://example.com/generated-image.jpg"`
  - **描述:** 结果图片的URL（有效期为2小时）

- `seed`
  - **类型:** `number`
  - **示例:** `123456`
  - **描述:** 随机种子

- `progress`
  - **类型:** `number`
  - **示例:** `100`
  - **描述:** 任务进度, 0~100

- `status`
  - **类型:** `string`
  - **示例:** `"succeeded"`
  - **描述:** 任务状态
    - `"running"`: 进行中
    - `"succeeded"`: 成功
    - `"failed"`: 失败

- `failure_reason`
  - **类型:** `string`
  - **示例:** `"error"`
  - **描述:** 失败原因
    - `"output_moderation"`: 输出违规
    - `"input_moderation"`: 输入违规
    - `"error"`: 其他错误
    - 当触发`"error"`时，会返还积分。
    - 触发`"output_moderation"`与`"input_moderation"`时，不会返还积分。
    - **提示:** 当触发`"error"`时，可尝试重新提交任务来确保系统稳定性。

- `error`
  - **类型:** `string`
  - **示例:** `"Invalid input parameters"`
  - **描述:** 失败详细信息